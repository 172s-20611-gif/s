<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>투명 배경 서명 다운로더</title>
    <!-- Tailwind CSS CDN 로드 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 폰트 설정 및 배경 스타일 */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        /* 캔버스 스타일 */
        #signatureCanvas {
            touch-action: none; /* 모바일에서 스크롤 방지 */
            border: 2px solid #e5e7eb; /* 밝은 회색 테두리 */
            cursor: crosshair;
            background-color: transparent; /* 캔버스 자체 배경은 투명 */
        }
    </style>
</head>
<body class="p-4 sm:p-8 min-h-screen flex items-center justify-center">

    <div class="w-full max-w-2xl bg-white shadow-xl rounded-2xl p-6 sm:p-8 space-y-6">
        <h1 class="text-3xl font-bold text-gray-800 text-center">
            서명 입력 및 다운로드
        </h1>
        <p class="text-center text-gray-500">
            아래 영역에 서명을 그리세요. 배경은 투명하게 저장됩니다.
        </p>

        <!-- 서명 캔버스 영역 -->
        <div class="relative w-full aspect-video border-4 border-dashed border-gray-300 rounded-lg overflow-hidden">
            <canvas id="signatureCanvas" class="w-full h-full"></canvas>
            <div id="drawing-instructions" class="absolute inset-0 flex items-center justify-center text-gray-400 pointer-events-none">
                마우스나 터치로 여기에 서명하세요.
            </div>
        </div>

        <!-- 컨트롤 버튼 -->
        <div class="flex flex-col sm:flex-row gap-3 justify-center">
            <button id="clearBtn"
                    class="flex-1 px-6 py-3 bg-red-500 text-white font-semibold rounded-lg shadow-md hover:bg-red-600 transition duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 7a1 1 0 012 0v5a1 1 0 11-2 0V7zm5 0a1 1 0 10-2 0v5a1 1 0 102 0V7z" clip-rule="evenodd" />
                </svg>
                서명 지우기
            </button>
            <button id="downloadBtn"
                    class="flex-1 px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 transition duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L10 11.586l1.293-1.293a1 1 0 111.414 1.414l-2 2a1 1 0 01-1.414 0l-2-2a1 1 0 010-1.414z" clip-rule="evenodd" />
                    <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v7a1 1 0 11-2 0V4a1 1 0 011-1z" clip-rule="evenodd" />
                </svg>
                PNG 다운로드 (투명 배경)
            </button>
        </div>

        <!-- 상태 메시지 -->
        <div id="message" class="text-center text-sm text-green-600 font-medium h-5"></div>
    </div>

    <script>
        const canvas = document.getElementById('signatureCanvas');
        const ctx = canvas.getContext('2d');
        const clearBtn = document.getElementById('clearBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const messageDiv = document.getElementById('message');
        const instructionsDiv = document.getElementById('drawing-instructions');

        let isDrawing = false;

        // 캔버스를 컨테이너 크기에 맞게 설정하고 해상도 조정 (선명도를 위해)
        function resizeCanvas() {
            const container = canvas.parentElement;
            const ratio = window.devicePixelRatio || 1;
            canvas.width = container.clientWidth * ratio;
            canvas.height = container.clientHeight * ratio;
            canvas.style.width = container.clientWidth + 'px';
            canvas.style.height = container.clientHeight + 'px';
            ctx.scale(ratio, ratio); // 고해상도 처리를 위한 스케일링

            // 드로잉 스타일 설정 (스케일링 후 적용)
            ctx.strokeStyle = '#000000'; // 검정색 펜
            ctx.lineWidth = 3; // 펜 두께
            ctx.lineCap = 'round'; // 선 끝 모양
            ctx.lineJoin = 'round'; // 선 연결 모양
        }

        // 캔버스 초기화 및 크기 조정
        window.addEventListener('load', resizeCanvas);
        window.addEventListener('resize', resizeCanvas);

        // 드로잉 시작 좌표를 얻는 헬퍼 함수
        function getCoords(event) {
            const rect = canvas.getBoundingClientRect();
            let x, y;

            if (event.touches && event.touches.length > 0) {
                // 터치 이벤트
                x = event.touches[0].clientX - rect.left;
                y = event.touches[0].clientY - rect.top;
            } else {
                // 마우스 이벤트
                x = event.clientX - rect.left;
                y = event.clientY - rect.top;
            }

            // 고해상도 캔버스에 맞춰 좌표 조정
            const ratio = canvas.width / rect.width;
            return { x: x * ratio, y: y * ratio };
        }

        // 드로잉 시작
        function startDrawing(e) {
            e.preventDefault(); // 기본 터치/마우스 동작 방지
            isDrawing = true;
            const { x, y } = getCoords(e);
            ctx.beginPath();
            ctx.moveTo(x, y);
            instructionsDiv.classList.add('hidden'); // 서명 시작 시 안내 문구 숨기기
        }

        // 드로잉 중
        function draw(e) {
            if (!isDrawing) return;
            e.preventDefault();
            const { x, y } = getCoords(e);
            ctx.lineTo(x, y);
            ctx.stroke();
        }

        // 드로잉 종료
        function stopDrawing() {
            if (!isDrawing) return;
            isDrawing = false;
            ctx.closePath();
            // 서명 후에도 캔버스가 비어있으면 안내 문구 다시 표시
            if (isCanvasEmpty()) {
                instructionsDiv.classList.remove('hidden');
            }
        }

        // 마우스 이벤트 리스너
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);

        // 터치 이벤트 리스너 (모바일 지원)
        canvas.addEventListener('touchstart', startDrawing);
        canvas.addEventListener('touchmove', draw);
        canvas.addEventListener('touchend', stopDrawing);

        // 캔버스 지우기 함수 (투명 배경 유지)
        function clearCanvas() {
            // clearRect는 캔버스 영역을 투명하게 지웁니다.
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            instructionsDiv.classList.remove('hidden'); // 안내 문구 다시 표시
            showMessage('서명이 지워졌습니다.', 'text-red-500');
        }

        clearBtn.addEventListener('click', clearCanvas);

        // 캔버스에 내용이 있는지 확인
        function isCanvasEmpty() {
            const pixelData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
            // 픽셀 데이터를 순회하며 불투명한 픽셀이 있는지 확인
            for (let i = 3; i < pixelData.length; i += 4) {
                if (pixelData[i] > 0) { // 알파 채널이 0보다 크면 내용이 있음
                    return false;
                }
            }
            return true;
        }


        // PNG 다운로드 함수
        function downloadSignature() {
            if (isCanvasEmpty()) {
                showMessage('서명 영역이 비어 있습니다. 먼저 서명을 해주세요.', 'text-red-500');
                return;
            }

            // canvas.toDataURL('image/png')를 사용하여 투명 배경 PNG 데이터 URL 생성
            const dataURL = canvas.toDataURL('image/png');

            // 다운로드를 위한 임시 링크 생성
            const a = document.createElement('a');
            a.href = dataURL;
            a.download = 'signature_transparent.png'; // 파일 이름 설정

            // 링크 클릭 이벤트 발생시켜 다운로드 트리거
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);

            showMessage('투명 배경 PNG 파일이 다운로드되었습니다!', 'text-blue-600');
        }

        downloadBtn.addEventListener('click', downloadSignature);

        // 메시지 표시 함수
        function showMessage(text, colorClass) {
            messageDiv.textContent = text;
            messageDiv.className = `text-center text-sm font-medium h-5 ${colorClass}`;
            setTimeout(() => {
                messageDiv.textContent = '';
                messageDiv.className = `text-center text-sm font-medium h-5`;
            }, 3000);
        }

    </script>
</body>
</html>